plugins {
    id 'java-library'
    id 'org.jetbrains.kotlin.jvm'
}

java {
    sourceCompatibility = JavaVersion.VERSION_17
    targetCompatibility = JavaVersion.VERSION_17
}

repositories {
    mavenCentral()
    maven { url "https://mvn.mchv.eu/repository/mchv/" }
}

dependencies {
    // TD Light Java
    //  implementation(platform("it.tdlight:tdlight-java-bom:2.8.4.1"))
    implementation("it.tdlight:tdlight-java:2.8.5.7")
    implementation("it.tdlight:tdlight-natives-windows-amd64:4.0.274")

    // SLF4J API
    implementation('org.slf4j:slf4j-api:2.0.7')
    implementation("org.slf4j:slf4j-simple:2.0.7")

}

// FIXME: The following file should exist before access, otherwise you'll get the Exception:
//     FileNotFoundException: Could not open [.../log/simple_telegram_client.log]
//     Maybe there is some work around to force SLF4J to create a not existing file
//     as a target output for logging. But for now it cannot.
//     So in order to prevent that exception make Gradle run a task that creates expected file
//     before `compile Kotlin` task
def logDir = "src/main/resources/tdlib/log"
def logFile = logDir.concat("/simple_telegram_client.log")

task createLoggingFile {
    doFirst {
        file(logDir).mkdir()
        file(logFile).createNewFile()
    }
}

compileKotlin.dependsOn createLoggingFile
